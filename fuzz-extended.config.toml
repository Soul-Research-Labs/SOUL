# Extended Fuzz Testing Configuration
# Run 1000+ hour campaigns for comprehensive security coverage

# =============================================================================
# FOUNDRY FUZZ CONFIGURATION
# =============================================================================

[profile.fuzz-extended]
# Run configuration
runs = 100000
max_test_rejects = 1000000
seed = 0  # Random seed for reproducibility

# Dictionary settings
dictionary_weight = 80
include_storage = true
include_push_bytes = true

# Memory/performance
ffi = false
memory_limit = 1073741824  # 1GB

# Timeout (seconds per test)
timeout = 3600

# Show traces for failing tests
verbosity = 3
show_progress = true

[profile.fuzz-invariant]
runs = 50000
depth = 500  # Maximum calls per run
fail_on_revert = false
call_override = false

# Shrinking
shrink_run_limit = 10000

# =============================================================================
# ECHIDNA EXTENDED CONFIGURATION
# =============================================================================
# Save as: echidna.extended.yaml

corpusDir: "echidna-corpus-extended"
testMode: assertion
testLimit: 500000
shrinkLimit: 50000
seqLen: 200
contractAddr: "0x00a329c0648769A73afAc7F9381E08FB43dBEA72"
deployer: "0x30000"
sender: ["0x10000", "0x20000", "0x30000"]
psender: 0x10000
coverage: true
checkAsserts: true

# Extended timeout
timeout: null  # No timeout for extended runs
stopOnFail: false

# Dictionary
dictFreq: 0.40
corpusPickFreq: 0.25

# Mutation
mutationConst: 20

# Multi-worker
workers: 8

# Filtering
filterBlacklist: true
filterFunctions: []

# RPC (for forking)
rpcUrl: null
rpcBlock: null

# Gas
maxGas: 12500000
maxTimeDelay: 604800  # 1 week
maxBlockDelay: 50400  # ~1 week of blocks

# Logging
format: text
quiet: false

# =============================================================================
# HALMOS CONFIGURATION
# =============================================================================
# Extended symbolic execution

[halmos]
# Solver settings
solver_timeout_branching = 3600  # 1 hour per branch
solver_max_memory = 8192  # 8GB

# Loop unrolling
loop_bound = 10
array_max_size = 10

# Storage
storage_layout = true

# Counterexample
dump_smt = true

# =============================================================================
# CAMPAIGN DEFINITIONS
# =============================================================================

[campaigns]

[campaigns.security-core]
name = "Security Core Contracts"
targets = [
    "contracts/security/MEVProtection.sol",
    "contracts/security/FlashLoanGuard.sol",
    "contracts/security/BridgeRateLimiter.sol",
    "contracts/security/BridgeCircuitBreaker.sol",
]
foundry_runs = 100000
echidna_limit = 500000
estimated_hours = 200

[campaigns.bridge-adapters]
name = "L2 Bridge Adapters"
targets = [
    "contracts/crosschain/ArbitrumBridgeAdapter.sol",
    "contracts/crosschain/OptimismBridgeAdapter.sol",
    "contracts/crosschain/BaseBridgeAdapter.sol",
    "contracts/crosschain/zkSyncBridgeAdapter.sol",
    "contracts/crosschain/ScrollBridgeAdapter.sol",
    "contracts/crosschain/LineaBridgeAdapter.sol",
    "contracts/crosschain/PolygonZkEVMBridgeAdapter.sol",
]
foundry_runs = 75000
echidna_limit = 300000
estimated_hours = 300

[campaigns.atomic-operations]
name = "Atomic Swap & Cross-L2"
targets = [
    "contracts/bridge/PILAtomicSwapV2.sol",
    "contracts/crosschain/CrossL2Atomicity.sol",
    "contracts/integrations/PILAtomicSwapSecurityIntegration.sol",
]
foundry_runs = 100000
echidna_limit = 400000
estimated_hours = 250

[campaigns.governance]
name = "Governance Contracts"
targets = [
    "contracts/governance/PILGovernor.sol",
    "contracts/security/PILMultiSigGovernance.sol",
    "contracts/security/PILUpgradeTimelock.sol",
]
foundry_runs = 50000
echidna_limit = 200000
estimated_hours = 100

[campaigns.fhe-primitives]
name = "FHE and Cryptographic Primitives"
targets = [
    "contracts/fhe/PILFHEModule.sol",
    "contracts/primitives/CrossDomainNullifierAlgebra.sol",
    "contracts/core/ProofCarryingContainer.sol",
]
foundry_runs = 75000
echidna_limit = 300000
estimated_hours = 150

[campaigns.pqc-verifiers]
name = "Post-Quantum Cryptography"
targets = [
    "contracts/pqc/DilithiumVerifier.sol",
    "contracts/pqc/KyberKEM.sol",
    "contracts/pqc/SPHINCSVerifier.sol",
]
foundry_runs = 50000
echidna_limit = 200000
estimated_hours = 100

# =============================================================================
# TOTAL ESTIMATED RUNTIME: 1100 hours
# =============================================================================
