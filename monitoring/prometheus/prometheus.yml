# PIL Protocol Prometheus Configuration
# Collects metrics from PIL infrastructure

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: 'pil-protocol'
    environment: 'production'

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - alertmanager:9093

# Rule files
rule_files:
  - "/etc/prometheus/alerts/*.yaml"
  - "/etc/prometheus/rules/*.yaml"

# Scrape configurations
scrape_configs:
  # ==========================================================================
  # PIL Contract Exporters
  # ==========================================================================
  - job_name: 'pil-ethereum'
    static_configs:
      - targets: ['pil-exporter-eth:9100']
    relabel_configs:
      - source_labels: [__address__]
        target_label: chain
        replacement: 'ethereum'
    metrics_path: /metrics

  - job_name: 'pil-sepolia'
    static_configs:
      - targets: ['pil-exporter-sepolia:9100']
    relabel_configs:
      - source_labels: [__address__]
        target_label: chain
        replacement: 'sepolia'

  - job_name: 'pil-arbitrum'
    static_configs:
      - targets: ['pil-exporter-arbitrum:9100']
    relabel_configs:
      - source_labels: [__address__]
        target_label: chain
        replacement: 'arbitrum'

  - job_name: 'pil-base'
    static_configs:
      - targets: ['pil-exporter-base:9100']
    relabel_configs:
      - source_labels: [__address__]
        target_label: chain
        replacement: 'base'

  - job_name: 'pil-optimism'
    static_configs:
      - targets: ['pil-exporter-optimism:9100']
    relabel_configs:
      - source_labels: [__address__]
        target_label: chain
        replacement: 'optimism'

  # ==========================================================================
  # Bridge Monitors
  # ==========================================================================
  - job_name: 'pil-bridge-cardano'
    static_configs:
      - targets: ['bridge-cardano:9101']
    relabel_configs:
      - source_labels: [__address__]
        target_label: bridge
        replacement: 'cardano'

  - job_name: 'pil-bridge-cosmos'
    static_configs:
      - targets: ['bridge-cosmos:9101']
    relabel_configs:
      - source_labels: [__address__]
        target_label: bridge
        replacement: 'cosmos'

  - job_name: 'pil-bridge-polkadot'
    static_configs:
      - targets: ['bridge-polkadot:9101']
    relabel_configs:
      - source_labels: [__address__]
        target_label: bridge
        replacement: 'polkadot'

  # ==========================================================================
  # Relayer Services
  # ==========================================================================
  - job_name: 'pil-relayers'
    static_configs:
      - targets:
          - 'relayer-1:9102'
          - 'relayer-2:9102'
          - 'relayer-3:9102'
    relabel_configs:
      - source_labels: [__address__]
        regex: 'relayer-(.+):.*'
        target_label: relayer_id
        replacement: '${1}'

  # ==========================================================================
  # ZK Prover Infrastructure
  # ==========================================================================
  - job_name: 'pil-provers'
    static_configs:
      - targets:
          - 'prover-groth16:9103'
          - 'prover-plonk:9103'
          - 'prover-halo2:9103'
    relabel_configs:
      - source_labels: [__address__]
        regex: 'prover-(.+):.*'
        target_label: prover_type
        replacement: '${1}'

  # ==========================================================================
  # PQC Services
  # ==========================================================================
  - job_name: 'pil-pqc'
    static_configs:
      - targets: ['pqc-service:9104']
    metrics_path: /metrics

  # ==========================================================================
  # API Gateways
  # ==========================================================================
  - job_name: 'pil-api'
    static_configs:
      - targets:
          - 'api-gateway-1:9090'
          - 'api-gateway-2:9090'
    metrics_path: /metrics

  # ==========================================================================
  # Node Exporters (Infrastructure)
  # ==========================================================================
  - job_name: 'node-exporters'
    static_configs:
      - targets:
          - 'node-1:9100'
          - 'node-2:9100'
          - 'node-3:9100'

  # ==========================================================================
  # Blackbox Exporter (Health Checks)
  # ==========================================================================
  - job_name: 'blackbox-http'
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
          - https://api.pil.network/health
          - https://bridge.pil.network/status
          - https://prover.pil.network/health
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox:9115

  # ==========================================================================
  # RPC Node Health
  # ==========================================================================
  - job_name: 'rpc-nodes'
    static_configs:
      - targets:
          - 'rpc-eth:8545'
          - 'rpc-arbitrum:8545'
          - 'rpc-base:8545'
          - 'rpc-optimism:8545'
    metrics_path: /metrics

# Remote write for long-term storage (optional)
# remote_write:
#   - url: "https://prometheus-prod-10-prod-us-central-0.grafana.net/api/prom/push"
#     basic_auth:
#       username: "${GRAFANA_CLOUD_USER}"
#       password: "${GRAFANA_CLOUD_KEY}"
